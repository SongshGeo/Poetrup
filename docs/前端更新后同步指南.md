# å‰ç«¯ä»£ç æ›´æ–°æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä» `Poetrupfrontend` ä»“åº“åŒæ­¥æ›´æ–°å‰ç«¯ä»£ç åˆ° Next.js é¡¹ç›®ã€‚

## ğŸ“‹ æ›´æ–°æµç¨‹æ¦‚è¿°

å½“å‰é›†æˆæ–¹å¼ï¼š**ç›´æ¥å¤åˆ¶ + è‡ªåŠ¨è½¬æ¢ + æ‰‹åŠ¨åˆå¹¶ Supabase API**

- âœ… ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œæ˜“äºç†è§£
- âš ï¸ æ³¨æ„ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç† Next.js ç‰¹å®šçš„è½¬æ¢å’Œ Supabase API é›†æˆ

## âš ï¸ é‡è¦æç¤º

**åœ¨æ›´æ–°å‰ç«¯ä»£ç ä¹‹å‰ï¼Œè¯·åŠ¡å¿…äº†è§£ï¼š**

1. **æ•°æ®æŒä¹…åŒ–å·²é›†æˆ**ï¼šå½“å‰é¡¹ç›®å·²å®Œå…¨é›†æˆ Supabase APIï¼Œæ‰€æœ‰æ•°æ®æ“ä½œéƒ½ä¼šä¿å­˜åˆ°æ•°æ®åº“
2. **ä¸è¦è¦†ç›– API è°ƒç”¨**ï¼šæ›´æ–°æ—¶ä¸è¦ç›´æ¥è¦†ç›–å·²é›†æˆ Supabase API çš„é¡µé¢æ–‡ä»¶
3. **ä¿ç•™æ•°æ®è½¬æ¢é€»è¾‘**ï¼š`dataTransform.ts` ä¸­çš„è½¬æ¢å‡½æ•°éœ€è¦ä¿ç•™
4. **ä¿ç•™è·¯ç”±ç»“æ„**ï¼šNext.js çš„è·¯ç”±ç»“æ„ï¼ˆ`/app/page.tsx`, `/app/poetry/collection/page.tsx` ç­‰ï¼‰éœ€è¦ä¿ç•™

## ğŸš€ å¿«é€Ÿæ›´æ–°ï¼ˆæ¨èï¼‰

ä½¿ç”¨æä¾›çš„æ›´æ–°è„šæœ¬ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./scripts/update-frontend.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ‹‰å–å‰ç«¯ä»“åº“æœ€æ–°ä»£ç 
2. åˆ›å»ºå¤‡ä»½
3. å¤åˆ¶ UI ç»„ä»¶å’Œä¸šåŠ¡ç»„ä»¶
4. åº”ç”¨åŸºæœ¬çš„è·¯å¾„è½¬æ¢
5. æç¤ºéœ€è¦æ‰‹åŠ¨å¤„ç†çš„éƒ¨åˆ†

## ğŸ“ æ‰‹åŠ¨æ›´æ–°æ­¥éª¤

å¦‚æœè„šæœ¬æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ–°ï¼š

### 1. æ‹‰å–å‰ç«¯ä»£ç 

```bash
# å¦‚æœè¿˜æ²¡æœ‰é…ç½®è¿œç¨‹ä»“åº“
git remote add frontend https://github.com/SongshGeo/Poetrupfrontend.git

# æ‹‰å–æœ€æ–°ä»£ç 
git fetch frontend
git checkout frontend/main -- tmp/poetrupfrontend
# æˆ–è€…ç›´æ¥å…‹éš†
git clone https://github.com/SongshGeo/Poetrupfrontend.git tmp/poetrupfrontend
cd tmp/poetrupfrontend
git pull origin main
```

### 2. æ›´æ–° UI ç»„ä»¶

```bash
# ä»ä¸´æ—¶ç›®å½•å¤åˆ¶ UI ç»„ä»¶
rm -rf nextjs/src/components/ui
cp -r tmp/poetrupfrontend/src/components/ui nextjs/src/components/
```

### 3. æ›´æ–°ä¸šåŠ¡ç»„ä»¶

éœ€è¦æ›´æ–°çš„ç»„ä»¶åˆ—è¡¨ï¼š
- `DraggableWord.tsx`
- `DroppableFolder.tsx`
- `DroppableTag.tsx`
- `PoemCollectionView.tsx`
- `PoemEditView.tsx`
- `PropertiesPanel.tsx`
- `SelectionBox.tsx`
- `Sidebar.tsx`
- `TornWordCard.tsx`
- `WordCard.tsx`
- `WordListItem.tsx`
- `WorkPanel.tsx`

```bash
# æ‰¹é‡å¤åˆ¶
for file in DraggableWord DroppableFolder DroppableTag PoemCollectionView PoemEditView PropertiesPanel SelectionBox Sidebar TornWordCard WordCard WordListItem WorkPanel; do
  cp tmp/poetrupfrontend/src/components/${file}.tsx nextjs/src/components/
done
```

### 4. åº”ç”¨ Next.js è½¬æ¢

#### 4.1 ä¿®å¤å¯¼å…¥è·¯å¾„

```bash
# åœ¨ nextjs/src/components ç›®å½•ä¸‹è¿è¡Œ
find . -name "*.tsx" -o -name "*.ts" | xargs sed -i '' \
  -e 's|from "\./ui/|from "@/components/ui/|g' \
  -e 's|from "\.\./ui/|from "@/components/ui/|g' \
  -e 's|from "\./TornWordCard|from "@/components/TornWordCard|g' \
  -e 's|from "\./WordCard|from "@/components/WordCard|g'
```

#### 4.2 ç§»é™¤ç‰ˆæœ¬å·

```bash
# ç§»é™¤å¯¼å…¥è·¯å¾„ä¸­çš„ç‰ˆæœ¬å·ï¼ˆå¦‚ sonner@2.0.3 -> sonnerï¼‰
find nextjs/src/components -name "*.tsx" -o -name "*.ts" | xargs sed -i '' 's/@[0-9][0-9.]*//g'
```

#### 4.3 ä¿®å¤å›¾æ ‡å¯¼å…¥

```bash
# XIcon -> X (lucide-react)
find nextjs/src/components -name "*.tsx" | xargs sed -i '' 's/XIcon/X/g'
```

### 5. æ›´æ–°ä¸»é¡µé¢ï¼ˆå¦‚æœ App.tsx æœ‰å˜åŒ–ï¼‰

**âš ï¸ é‡è¦ï¼šä¸è¦ç›´æ¥è¦†ç›– `nextjs/src/app/app/page.tsx`ï¼**

å¦‚æœå‰ç«¯åŒäº‹æ›´æ–°äº† `App.tsx`ï¼Œéœ€è¦**æ‰‹åŠ¨åˆå¹¶**å˜æ›´ï¼Œè€Œä¸æ˜¯ç›´æ¥æ›¿æ¢ï¼š

**åˆå¹¶ç­–ç•¥ï¼š**

1. **å¯¹æ¯”å·®å¼‚**ï¼š
   ```bash
   # æŸ¥çœ‹å‰ç«¯ App.tsx çš„å˜æ›´
   diff -u nextjs/src/app/app/page.tsx tmp/poetrupfrontend/src/App.tsx
   ```

2. **ä¿ç•™ Supabase API é›†æˆ**ï¼š
   - âœ… ä¿ç•™æ‰€æœ‰ `getWords`, `createWord`, `updateWord` ç­‰ API è°ƒç”¨
   - âœ… ä¿ç•™æ‰€æœ‰ `getCollections`, `createCollection`, `addWordToCollection` ç­‰ API è°ƒç”¨
   - âœ… ä¿ç•™æ‰€æœ‰ `getPoetry`, `createPoetryWithContent`, `updatePoetry` ç­‰ API è°ƒç”¨
   - âœ… ä¿ç•™ `useEffect` ä¸­çš„æ•°æ®åŠ è½½é€»è¾‘
   - âœ… ä¿ç•™ `handleDropToFolder` å’Œ `handleDropToTag` ä¸­çš„æ•°æ®åº“ä¿å­˜é€»è¾‘
   - âœ… ä¿ç•™æ ‡ç­¾ä¿å­˜åˆ° `profile.metadata` çš„é€»è¾‘

3. **åˆå¹¶ UI å˜æ›´**ï¼š
   - å¦‚æœå‰ç«¯æ›´æ–°äº† UI ç»„ä»¶ç»“æ„ï¼Œæ‰‹åŠ¨åˆå¹¶åˆ°ç°æœ‰ä»£ç 
   - å¦‚æœå‰ç«¯æ›´æ–°äº†æ ·å¼ç±»åï¼Œæ›´æ–°å¯¹åº”çš„ className
   - å¦‚æœå‰ç«¯æ›´æ–°äº†äº¤äº’é€»è¾‘ï¼Œåœ¨ä¿ç•™ API è°ƒç”¨çš„å‰æä¸‹æ›´æ–°

4. **ä¿ç•™ Next.js ç‰¹å®šä»£ç **ï¼š
   ```tsx
   // å¿…é¡»ä¿ç•™çš„éƒ¨åˆ†ï¼š
   "use client";
   import { useRouter } from "next/navigation";
   import { useGlobal } from "@/lib/context/GlobalContext";
   import { createSPAClient } from "@/lib/supabase/client";
   import { getWords, createWord, updateWord } from "@/lib/api/words";
   // ... å…¶ä»– Supabase API å¯¼å…¥
   
   export default function PoetryPage() {
     const router = useRouter();
     const { user, loading: userLoading } = useGlobal();
     // ... ä¿ç•™æ‰€æœ‰ Supabase æ•°æ®åŠ è½½å’Œä¿å­˜é€»è¾‘
   }
   ```

**ä¸»è¦è½¬æ¢ç‚¹ï¼š**
1. âœ… æ·»åŠ  `"use client"` æŒ‡ä»¤ï¼ˆå¦‚æœç¼ºå¤±ï¼‰
2. âœ… ä½¿ç”¨ `useRouter()` æ›¿ä»£å†…éƒ¨è·¯ç”±çŠ¶æ€
3. âœ… å°† `setAppViewMode('poem-collection')` æ”¹ä¸º `router.push('/app/poetry/collection')`
4. âœ… é›†æˆ `useGlobal()` è·å–ç”¨æˆ·ä¿¡æ¯
5. âœ… é›†æˆ `createSPAClient()` å¤„ç†æ•°æ®åº“æ“ä½œ
6. âœ… **ä¿ç•™æ‰€æœ‰ Supabase API è°ƒç”¨å’Œæ•°æ®æŒä¹…åŒ–é€»è¾‘**

### 6. æ›´æ–°æ ·å¼æ–‡ä»¶

å¦‚æœ `globals.css` æœ‰çº¸å¼ çº¹ç†ç›¸å…³çš„æ›´æ–°ï¼Œéœ€è¦æ‰‹åŠ¨åˆå¹¶ï¼š

```bash
# æŸ¥çœ‹å‰ç«¯æ ·å¼
cat tmp/poetrupfrontend/src/index.css

# æ‰‹åŠ¨åˆå¹¶åˆ°
# nextjs/src/app/globals.css
```

éœ€è¦ä¿ç•™çš„æ ·å¼ï¼š
- `:root` ä¸­çš„çº¸å¼ çº¹ç†å˜é‡
- `.paper-bg`, `.paper-card` ç­‰å·¥å…·ç±»
- åŠ¨ç”»å®šä¹‰ï¼ˆ`@keyframes`ï¼‰

### 7. æ›´æ–°ä¾èµ–

æ£€æŸ¥å‰ç«¯ `package.json` æ˜¯å¦æœ‰æ–°ä¾èµ–ï¼š

```bash
# å¯¹æ¯”ä¾èµ–
diff <(cat tmp/poetrupfrontend/package.json | jq '.dependencies') \
     <(cat nextjs/package.json | jq '.dependencies')
```

å¦‚æœæœ‰æ–°ä¾èµ–ï¼Œæ·»åŠ åˆ° `nextjs/package.json` å¹¶è¿è¡Œï¼š

```bash
cd nextjs
yarn install
```

## ğŸ”„ Supabase API é›†æˆè¯´æ˜

### å·²é›†æˆçš„ API åŠŸèƒ½

å½“å‰é¡¹ç›®å·²ç»å®Œå…¨é›†æˆäº† Supabase APIï¼Œä»¥ä¸‹åŠŸèƒ½**ä¸åº”è¯¥è¢«è¦†ç›–**ï¼š

#### ä¸»é¡µé¢ (`/app/page.tsx`)
- âœ… è¯è¯­ç®¡ç†ï¼š`getWords`, `createWord`, `updateWord`
- âœ… æ”¶è—å†Œç®¡ç†ï¼š`getCollections`, `getCollectionWithWords`, `createCollection`, `addWordToCollection`
- âœ… ä½œå“ç®¡ç†ï¼š`getPoetryByCreator`, `createPoetryWithContent`
- âœ… æ ‡ç­¾ç®¡ç†ï¼šä¿å­˜åˆ° `profile.metadata.tags`
- âœ… æ•°æ®æŒä¹…åŒ–ï¼šæ‹–åŠ¨è¯è¯­åˆ°æ”¶è—å†Œ/æ ‡ç­¾éƒ½ä¼šä¿å­˜åˆ°æ•°æ®åº“

#### ä½œå“é›†é¡µé¢ (`/app/poetry/collection/page.tsx`)
- âœ… ä½œå“åˆ—è¡¨ï¼š`getPoetryByCreator`
- âœ… ä½œå“åˆ é™¤ï¼š`deletePoetry`
- âœ… æ”¶è—å†ŒåŠ è½½ï¼š`getCollections`

#### ç¼–è¾‘é¡µé¢ (`/app/poetry/edit/[id]/page.tsx`)
- âœ… ä½œå“åŠ è½½ï¼š`getPoetryById`
- âœ… ä½œå“æ›´æ–°ï¼š`updatePoetry`
- âœ… è¯è¯­å’Œæ”¶è—å†ŒåŠ è½½ï¼š`getWords`, `getCollections`, `getCollectionWithWords`

### æ•°æ®è½¬æ¢å‡½æ•°

**ä¸è¦åˆ é™¤æˆ–è¦†ç›–** `nextjs/src/lib/utils/dataTransform.ts`ï¼š
- `transformWord()` - å°†æ•°æ®åº“è¯è¯­è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼
- `transformCollection()` - å°†æ•°æ®åº“æ”¶è—å†Œè½¬æ¢ä¸ºå‰ç«¯æ ¼å¼
- `transformPoetry()` - å°†æ•°æ®åº“ä½œå“è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼

### æ›´æ–°æ—¶çš„æ³¨æ„äº‹é¡¹

1. **å¦‚æœå‰ç«¯æ›´æ–°äº†æ•°æ®ç»“æ„**ï¼š
   - æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–° `dataTransform.ts` ä¸­çš„è½¬æ¢å‡½æ•°
   - æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°æ•°æ®åº“ schemaï¼ˆå¯èƒ½éœ€è¦æ–°çš„ migrationï¼‰

2. **å¦‚æœå‰ç«¯æ›´æ–°äº†äº¤äº’é€»è¾‘**ï¼š
   - åœ¨ä¿ç•™ Supabase API è°ƒç”¨çš„å‰æä¸‹æ›´æ–°äº¤äº’é€»è¾‘
   - ç¡®ä¿æ‰€æœ‰æ•°æ®æ“ä½œéƒ½è°ƒç”¨ç›¸åº”çš„ API å‡½æ•°

3. **å¦‚æœå‰ç«¯æ·»åŠ äº†æ–°åŠŸèƒ½**ï¼š
   - æ£€æŸ¥æ˜¯å¦éœ€è¦æ–°çš„ API å‡½æ•°ï¼ˆåœ¨ `nextjs/src/lib/api/` ä¸­æ·»åŠ ï¼‰
   - æ£€æŸ¥æ˜¯å¦éœ€è¦æ–°çš„æ•°æ®åº“è¡¨æˆ–å­—æ®µï¼ˆåˆ›å»º migrationï¼‰

## âš ï¸ å¸¸è§é—®é¢˜

### 1. å¯¼å…¥è·¯å¾„é”™è¯¯

**é—®é¢˜ï¼š** `Module not found: Can't resolve './utils'`

**è§£å†³ï¼š** ç¡®ä¿æ‰€æœ‰ç›¸å¯¹å¯¼å…¥éƒ½æ”¹ä¸º `@/` åˆ«åï¼š
```bash
find nextjs/src -name "*.tsx" | xargs sed -i '' 's|from "\./utils|from "@/lib/utils|g'
```

### 2. ç‰ˆæœ¬å·å¯¼å…¥

**é—®é¢˜ï¼š** `Module not found: Can't resolve 'sonner@2.0.3'`

**è§£å†³ï¼š** ç§»é™¤å¯¼å…¥è·¯å¾„ä¸­çš„ç‰ˆæœ¬å·ï¼š
```bash
find nextjs/src -name "*.tsx" | xargs sed -i '' 's/@[0-9][0-9.]*//g'
```

### 3. è·¯ç”±è·³è½¬é—®é¢˜

**é—®é¢˜ï¼š** é¡µé¢è·³è½¬ä¸å·¥ä½œ

**è§£å†³ï¼š** ç¡®ä¿ä½¿ç”¨ Next.js çš„ `useRouter`ï¼š
```tsx
import { useRouter } from "next/navigation";
const router = useRouter();
router.push('/app/poetry/collection');
```

### 4. æ ·å¼ä¸¢å¤±

**é—®é¢˜ï¼š** çº¸å¼ çº¹ç†æ ·å¼ä¸æ˜¾ç¤º

**è§£å†³ï¼š** æ£€æŸ¥ `globals.css` ä¸­çš„ CSS å˜é‡å’Œå·¥å…·ç±»æ˜¯å¦å®Œæ•´ã€‚

### 5. æ•°æ®ä¸ä¿å­˜

**é—®é¢˜ï¼š** æ›´æ–°åæ•°æ®æ“ä½œä¸ä¿å­˜åˆ°æ•°æ®åº“

**è§£å†³ï¼š** 
- æ£€æŸ¥æ˜¯å¦æ„å¤–è¦†ç›–äº† Supabase API è°ƒç”¨
- æ£€æŸ¥ `handleDropToFolder` å’Œ `handleDropToTag` æ˜¯å¦åŒ…å« API è°ƒç”¨
- æ£€æŸ¥ `handleCreateTag` æ˜¯å¦ä¿å­˜åˆ° `profile.metadata`
- æ£€æŸ¥ `handleCreateFolder` æ˜¯å¦è°ƒç”¨ `createCollection` API

### 6. åˆ·æ–°åæ•°æ®ä¸¢å¤±

**é—®é¢˜ï¼š** åˆ·æ–°é¡µé¢åæ•°æ®æ¶ˆå¤±

**è§£å†³ï¼š** 
- ç¡®ä¿æ‰€æœ‰æ•°æ®åŠ è½½éƒ½åœ¨ `useEffect` ä¸­è°ƒç”¨ Supabase API
- æ£€æŸ¥ `useEffect` çš„ä¾èµ–æ•°ç»„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ API è°ƒç”¨æ˜¯å¦æˆåŠŸï¼ˆæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼‰

## ğŸ”„ æ›´æ–°æ£€æŸ¥æ¸…å•

æ›´æ–°å®Œæˆåï¼Œè¯·æ£€æŸ¥ï¼š

### åŸºç¡€æ£€æŸ¥
- [ ] æ‰€æœ‰ç»„ä»¶å¯¼å…¥è·¯å¾„æ­£ç¡®ï¼ˆä½¿ç”¨ `@/` åˆ«åï¼‰
- [ ] æ²¡æœ‰ç‰ˆæœ¬å·åœ¨å¯¼å…¥è·¯å¾„ä¸­
- [ ] è·¯ç”±è·³è½¬ä½¿ç”¨ `useRouter()`
- [ ] ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤ºï¼ˆä½¿ç”¨ `useGlobal()`ï¼‰
- [ ] æ ·å¼æ–‡ä»¶å®Œæ•´ï¼ˆçº¸å¼ çº¹ç†ç›¸å…³ï¼‰
- [ ] ä¾èµ–å·²æ›´æ–°ï¼ˆ`yarn install`ï¼‰
- [ ] TypeScript æ— é”™è¯¯ï¼ˆ`yarn lint`ï¼‰
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸è¿è¡Œï¼ˆ`yarn dev`ï¼‰

### Supabase API é›†æˆæ£€æŸ¥
- [ ] ä¸»é¡µé¢æ•°æ®åŠ è½½æ­£å¸¸ï¼ˆè¯è¯­ã€æ”¶è—å†Œã€ä½œå“ï¼‰
- [ ] åˆ›å»ºè¯è¯­ä¿å­˜åˆ°æ•°æ®åº“
- [ ] åˆ›å»ºæ”¶è—å†Œä¿å­˜åˆ°æ•°æ®åº“
- [ ] åˆ›å»ºä½œå“ä¿å­˜åˆ°æ•°æ®åº“
- [ ] æ‹–åŠ¨è¯è¯­åˆ°æ”¶è—å†Œä¿å­˜åˆ°æ•°æ®åº“
- [ ] æ‹–åŠ¨è¯è¯­åˆ°æ ‡ç­¾æ›´æ–°åˆ°æ•°æ®åº“
- [ ] åˆ›å»ºæ–°æ ‡ç­¾ä¿å­˜åˆ° `profile.metadata`
- [ ] åˆ·æ–°é¡µé¢åæ•°æ®ä»ç„¶å­˜åœ¨
- [ ] ä½œå“é›†é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½å’Œåˆ é™¤ä½œå“
- [ ] ç¼–è¾‘é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½å’Œä¿å­˜ä½œå“

### åŠŸèƒ½æµ‹è¯•
- [ ] æ·»åŠ è¯è¯­åŠŸèƒ½æ­£å¸¸
- [ ] åˆ›å»ºæ”¶è—å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] åˆ›å»ºä½œå“åŠŸèƒ½æ­£å¸¸
- [ ] æ‹–åŠ¨è¯è¯­åˆ°æ”¶è—å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] æ‹–åŠ¨è¯è¯­åˆ°æ ‡ç­¾åŠŸèƒ½æ­£å¸¸
- [ ] åˆ›å»ºæ–°æ ‡ç­¾åŠŸèƒ½æ­£å¸¸
- [ ] ä½œå“ç¼–è¾‘å’Œä¿å­˜åŠŸèƒ½æ­£å¸¸
- [ ] ä½œå“åˆ é™¤åŠŸèƒ½æ­£å¸¸

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥å¤‡ä»½ç›®å½•ï¼š`backups/YYYYMMDD_HHMMSS/`
2. æŸ¥çœ‹å‰ç«¯ä»“åº“çš„å˜æ›´ï¼š`git log tmp/poetrupfrontend`
3. å¯¹æ¯”æ–‡ä»¶å·®å¼‚ï¼š`diff -r nextjs/src/components tmp/poetrupfrontend/src/components`

## ğŸ¯ æœ€ä½³å®è·µ

1. **æ›´æ–°å‰å¤‡ä»½**ï¼šè„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½
2. **å°æ­¥æ›´æ–°**ï¼šæ¯æ¬¡åªæ›´æ–°ä¸€éƒ¨åˆ†ï¼Œæµ‹è¯•é€šè¿‡åå†ç»§ç»­
3. **ä¿ç•™è½¬æ¢è®°å½•**ï¼šè®°å½•æ‰‹åŠ¨ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œä¾¿äºåç»­å‚è€ƒ
4. **æµ‹è¯•ä¼˜å…ˆ**ï¼šæ›´æ–°åç«‹å³æµ‹è¯•ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸
5. **ä¿æŠ¤ API é›†æˆ**ï¼š**æ°¸è¿œä¸è¦ç›´æ¥è¦†ç›–å·²é›†æˆ Supabase API çš„æ–‡ä»¶**
6. **æ‰‹åŠ¨åˆå¹¶**ï¼šå¯¹äºä¸»é¡µé¢å’Œä¸šåŠ¡é€»è¾‘æ–‡ä»¶ï¼Œä½¿ç”¨æ‰‹åŠ¨åˆå¹¶è€Œä¸æ˜¯ç›´æ¥æ›¿æ¢
7. **éªŒè¯æ•°æ®æŒä¹…åŒ–**ï¼šæ¯æ¬¡æ›´æ–°åæµ‹è¯•æ•°æ®æ˜¯å¦æ­£å¸¸ä¿å­˜å’ŒåŠ è½½

## ğŸ“š æ–‡ä»¶æ˜ å°„å…³ç³»

äº†è§£å‰ç«¯ä»£ç ä¸ Next.js é¡¹ç›®çš„å¯¹åº”å…³ç³»ï¼š

| å‰ç«¯æ–‡ä»¶ï¼ˆVite + Reactï¼‰ | Next.js æ–‡ä»¶ | è¯´æ˜ |
|-------------------------|-------------|------|
| `src/App.tsx` | `nextjs/src/app/app/page.tsx` | **æ‰‹åŠ¨åˆå¹¶ï¼Œä¸è¦ç›´æ¥è¦†ç›–** |
| `src/components/ui/*` | `nextjs/src/components/ui/*` | å¯ä»¥ç›´æ¥è¦†ç›– |
| `src/components/*.tsx` | `nextjs/src/components/*.tsx` | å¯ä»¥ç›´æ¥è¦†ç›–ï¼ˆä¸šåŠ¡ç»„ä»¶ï¼‰ |
| `src/index.css` | `nextjs/src/app/globals.css` | æ‰‹åŠ¨åˆå¹¶çº¸å¼ çº¹ç†æ ·å¼ |
| - | `nextjs/src/lib/api/*.ts` | **ä¸è¦ä¿®æ”¹**ï¼ˆSupabase APIï¼‰ |
| - | `nextjs/src/lib/utils/dataTransform.ts` | **ä¸è¦ä¿®æ”¹**ï¼ˆæ•°æ®è½¬æ¢ï¼‰ |
| - | `nextjs/src/app/app/poetry/collection/page.tsx` | **æ‰‹åŠ¨åˆå¹¶ï¼Œä¸è¦ç›´æ¥è¦†ç›–** |
| - | `nextjs/src/app/app/poetry/edit/[id]/page.tsx` | **æ‰‹åŠ¨åˆå¹¶ï¼Œä¸è¦ç›´æ¥è¦†ç›–** |

## ğŸ” æ›´æ–°ç­–ç•¥æ€»ç»“

### âœ… å¯ä»¥ç›´æ¥è¦†ç›–çš„æ–‡ä»¶
- UI ç»„ä»¶ï¼ˆ`nextjs/src/components/ui/*`ï¼‰
- ä¸šåŠ¡ç»„ä»¶ï¼ˆ`DraggableWord.tsx`, `Sidebar.tsx` ç­‰ï¼‰
- æ ·å¼æ–‡ä»¶ï¼ˆéœ€è¦æ‰‹åŠ¨åˆå¹¶çº¸å¼ çº¹ç†éƒ¨åˆ†ï¼‰

### âš ï¸ éœ€è¦æ‰‹åŠ¨åˆå¹¶çš„æ–‡ä»¶
- `nextjs/src/app/app/page.tsx` - ä¸»é¡µé¢ï¼ˆåŒ…å« Supabase API é›†æˆï¼‰
- `nextjs/src/app/app/poetry/collection/page.tsx` - ä½œå“é›†é¡µé¢
- `nextjs/src/app/app/poetry/edit/[id]/page.tsx` - ç¼–è¾‘é¡µé¢
- `nextjs/src/app/globals.css` - å…¨å±€æ ·å¼ï¼ˆåˆå¹¶çº¸å¼ çº¹ç†æ ·å¼ï¼‰

### ğŸš« ä¸è¦ä¿®æ”¹çš„æ–‡ä»¶
- `nextjs/src/lib/api/*.ts` - Supabase API å‡½æ•°
- `nextjs/src/lib/utils/dataTransform.ts` - æ•°æ®è½¬æ¢å‡½æ•°
- `nextjs/src/lib/types.ts` - ç±»å‹å®šä¹‰
- `nextjs/src/lib/supabase/*.ts` - Supabase å®¢æˆ·ç«¯é…ç½®

## ğŸ’¡ æ›´æ–°ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå‰ç«¯æ›´æ–°äº† UI ç»„ä»¶

```bash
# 1. è¿è¡Œæ›´æ–°è„šæœ¬
./scripts/update-frontend.sh

# 2. æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç»„ä»¶
ls tmp/poetrupfrontend/src/components/ui/

# 3. å¦‚æœè„šæœ¬å·²è‡ªåŠ¨å¤åˆ¶ï¼Œæ£€æŸ¥å¯¼å…¥è·¯å¾„
cd nextjs
yarn lint

# 4. æµ‹è¯•åº”ç”¨
yarn dev
```

### ç¤ºä¾‹ 2ï¼šå‰ç«¯æ›´æ–°äº†ä¸»é¡µé¢é€»è¾‘

```bash
# 1. è¿è¡Œæ›´æ–°è„šæœ¬ï¼ˆä¼šæç¤ºéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼‰
./scripts/update-frontend.sh

# 2. å¯¹æ¯”å·®å¼‚
diff -u nextjs/src/app/app/page.tsx tmp/poetrupfrontend/src/App.tsx > changes.diff

# 3. æ‰‹åŠ¨åˆå¹¶å˜æ›´ï¼ˆä¿ç•™æ‰€æœ‰ Supabase API è°ƒç”¨ï¼‰
# ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ‰‹åŠ¨åˆå¹¶ï¼š
# - ä¿ç•™æ‰€æœ‰ import { ... } from '@/lib/api/...' 
# - ä¿ç•™æ‰€æœ‰ useEffect ä¸­çš„æ•°æ®åŠ è½½é€»è¾‘
# - ä¿ç•™æ‰€æœ‰ handleDropToFolder, handleDropToTag ä¸­çš„ API è°ƒç”¨
# - åˆå¹¶ UI å˜æ›´å’Œäº¤äº’é€»è¾‘

# 4. æµ‹è¯•åŠŸèƒ½
yarn dev
# æµ‹è¯•ï¼šåˆ›å»ºè¯è¯­ã€æ‹–åŠ¨åˆ°æ”¶è—å†Œã€åˆ·æ–°é¡µé¢éªŒè¯æ•°æ®æ˜¯å¦ä¿å­˜
```

### ç¤ºä¾‹ 3ï¼šå‰ç«¯æ·»åŠ äº†æ–°åŠŸèƒ½

```bash
# 1. æ£€æŸ¥æ–°åŠŸèƒ½æ˜¯å¦éœ€è¦æ•°æ®åº“æ”¯æŒ
# æŸ¥çœ‹å‰ç«¯ä»£ç ï¼Œäº†è§£æ–°åŠŸèƒ½çš„æ•°æ®éœ€æ±‚

# 2. å¦‚æœéœ€è¦æ–°è¡¨æˆ–å­—æ®µï¼Œåˆ›å»º migration
cd supabase
supabase migration new add_new_feature

# 3. å¦‚æœéœ€è¦æ–° APIï¼Œåœ¨ nextjs/src/lib/api/ ä¸­æ·»åŠ å‡½æ•°

# 4. æ›´æ–°é¡µé¢æ–‡ä»¶ï¼Œé›†æˆæ–° API

# 5. æµ‹è¯•æ–°åŠŸèƒ½
yarn dev
```

## ğŸš¨ å…³é”®æé†’

### æ›´æ–°å‰å¿…è¯»

åœ¨æ›´æ–°å‰ç«¯ä»£ç ä¹‹å‰ï¼Œè¯·åŠ¡å¿…è®°ä½ï¼š

1. **æ•°æ®æŒä¹…åŒ–æ˜¯å…³é”®**ï¼šå½“å‰é¡¹ç›®çš„æ‰€æœ‰æ•°æ®æ“ä½œéƒ½å·²é›†æˆ Supabase API
2. **ä¸è¦ç›´æ¥è¦†ç›–é¡µé¢æ–‡ä»¶**ï¼šä¸»é¡µé¢ã€ä½œå“é›†é¡µé¢ã€ç¼–è¾‘é¡µé¢éƒ½éœ€è¦æ‰‹åŠ¨åˆå¹¶
3. **ä¿æŠ¤ API é›†æˆ**ï¼šæ‰€æœ‰ `@/lib/api/*` çš„å¯¼å…¥å’Œè°ƒç”¨éƒ½å¿…é¡»ä¿ç•™
4. **æµ‹è¯•æ•°æ®æŒä¹…åŒ–**ï¼šæ›´æ–°ååŠ¡å¿…æµ‹è¯•æ•°æ®æ˜¯å¦èƒ½æ­£å¸¸ä¿å­˜å’ŒåŠ è½½

### å¿«é€Ÿå†³ç­–æ ‘

```
å‰ç«¯æ›´æ–°äº†ä»€ä¹ˆï¼Ÿ
â”‚
â”œâ”€ UI ç»„ä»¶ (ui/*)
â”‚  â””â”€ âœ… å¯ä»¥ç›´æ¥è¦†ç›–
â”‚
â”œâ”€ ä¸šåŠ¡ç»„ä»¶ (DraggableWord.tsx ç­‰)
â”‚  â””â”€ âœ… å¯ä»¥ç›´æ¥è¦†ç›–ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨ä¿®å¤å¯¼å…¥è·¯å¾„ï¼‰
â”‚
â”œâ”€ ä¸»é¡µé¢é€»è¾‘ (App.tsx)
â”‚  â””â”€ âš ï¸ æ‰‹åŠ¨åˆå¹¶ï¼ˆä¿ç•™æ‰€æœ‰ Supabase API è°ƒç”¨ï¼‰
â”‚
â”œâ”€ æ ·å¼æ–‡ä»¶ (index.css)
â”‚  â””â”€ âš ï¸ æ‰‹åŠ¨åˆå¹¶ï¼ˆä¿ç•™çº¸å¼ çº¹ç†æ ·å¼ï¼‰
â”‚
â””â”€ æ–°åŠŸèƒ½
   â””â”€ âš ï¸ æ£€æŸ¥æ˜¯å¦éœ€è¦æ–° API æˆ–æ•°æ®åº“è¿ç§»
```

## ğŸ“– ç›¸å…³æ–‡æ¡£

- Supabase API æ–‡æ¡£ï¼š`nextjs/src/lib/api/README.md`
- æ•°æ®è½¬æ¢å‡½æ•°ï¼š`nextjs/src/lib/utils/dataTransform.ts`
- æ•°æ®åº“ Schemaï¼š`supabase/migrations/`

